<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Receipt processor challenge</title>
    <script>
      async function addProcess() {
        var value = document.getElementById("processInput").value;
        await fetch("/receipts/process", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ data: JSON.parse(value) }),
        })
          .then(async (res) => {
            console.log(res);
            res = await res.json();
            const ele = document.getElementById("process-container-span");
            ele.innerHTML = `<h3><b>id:</b> ${res.id}</h3>`;
          })
          .catch((err) => {
            const ele = document.getElementById("process-container-span");
            ele.innerHTML = `<h3>Invalid JSON</h3>`;
          });
      }

      async function getPoints() {
        var id = document.getElementById("get-id").value;
        const response = await fetch(`/receipts/${id}/points`)
          .then(async (res) => {
            console.log(res);
            res = await res.json();
            const ele = document.getElementById("points-container-span");
            const message = res.points
              ? `<h3><b>Points:</b> ${res.points}</h3>`
              : `<h3>${res.message}</h3>`;
            ele.innerHTML = message;
          })
          .catch((err) => {
            const ele = document.getElementById("points-container-span");
            ele.innerHTML = `<h3>An error has occured</h3>`;
          });
      }
    </script>
  </head>
  <body>
    <div id="process-container">
      <textarea
        style="width: 200px; height: 100px"
        id="processInput"
        class="text-input"
        name="bigTextBox"
        placeholder="Enter the json..."
      ></textarea>
      <button onclick="addProcess()">Post</button>
      <span id="process-container-span"></span>
    </div>
    <div id="points-container">
      <textarea
        id="get-id"
        class="text-input"
        name="bigTextBox"
        placeholder="Enter id..."
      ></textarea>
      <button onclick="getPoints()">Get points</button>
      <span id="points-container-span"></span>
    </div>
  </body>
</html>
